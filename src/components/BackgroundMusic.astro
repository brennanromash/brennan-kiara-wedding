---
---

<div class="fixed bottom-4 right-4 z-50">
  <button
    id="music-toggle"
    class="bg-[#F5F5DC] text-[#2F4F4F] border-2 border-[#2F4F4F] rounded-full p-3 shadow-lg hover:bg-[#EEDC82] transition-colors flex items-center justify-center"
    aria-label="Toggle music"
  >
    <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  </button>
  <audio id="bg-music" loop>
    <source src="/song.mp3" type="audio/mpeg" />
    Your browser does not support the audio element.
  </audio>
</div>

<script>
  const music = document.getElementById('bg-music') as HTMLAudioElement;
  const toggleBtn = document.getElementById('music-toggle');
  const playIcon = document.getElementById('play-icon');
  const pauseIcon = document.getElementById('pause-icon');

  let isPlaying = false;

  const toggleMusic = () => {
    if (isPlaying) {
      music.pause();
      playIcon?.classList.remove('hidden');
      pauseIcon?.classList.add('hidden');
    } else {
      music.play().catch(e => console.log("Playback failed:", e));
      playIcon?.classList.add('hidden');
      pauseIcon?.classList.remove('hidden');
    }
    isPlaying = !isPlaying;
  };

  toggleBtn?.addEventListener('click', toggleMusic);

  // First interaction autoplay attempt
  const startAutoplay = () => {
    if (!isPlaying) {
      music.play()
        .then(() => {
          isPlaying = true;
          playIcon?.classList.add('hidden');
          pauseIcon?.classList.remove('hidden');
          // Remove listeners once music starts
          document.removeEventListener('click', startAutoplay);
          document.removeEventListener('scroll', startAutoplay);
          document.removeEventListener('touchstart', startAutoplay);
        })
        .catch(e => {
          console.log("Autoplay blocked, waiting for manual interaction:", e);
        });
    }
  };

  document.addEventListener('click', startAutoplay);
  document.addEventListener('scroll', startAutoplay);
  document.addEventListener('touchstart', startAutoplay);
</script>
